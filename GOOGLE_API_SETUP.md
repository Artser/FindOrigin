# Инструкция по настройке Google Custom Search API

## Шаг 1: Создание проекта в Google Cloud Console

1. Перейдите на [Google Cloud Console](https://console.cloud.google.com/)

2. Войдите в свой Google аккаунт (или создайте новый)

3. Создайте новый проект:
   - Нажмите на выпадающий список проектов в верхней панели (рядом с логотипом Google Cloud)
   - Нажмите **"New Project"** (Новый проект)
   - Введите название проекта (например: "FindOrigin Bot")
   - Нажмите **"Create"** (Создать)
   - Дождитесь создания проекта (обычно несколько секунд)

4. Выберите созданный проект из списка проектов

## Шаг 2: Включение Custom Search API

1. В меню слева найдите **"APIs & Services"** (APIs и сервисы) → **"Library"** (Библиотека)

2. В поисковой строке введите: **"Custom Search API"**

3. Нажмите на **"Custom Search API"** в результатах поиска

4. На странице API нажмите кнопку **"Enable"** (Включить)

5. Дождитесь активации API (обычно несколько секунд)

## Шаг 3: Создание API ключа

1. В меню слева перейдите в **"APIs & Services"** → **"Credentials"** (Учетные данные)

2. Нажмите **"+ CREATE CREDENTIALS"** (Создать учетные данные) в верхней панели

3. Выберите **"API key"** (Ключ API)

4. Ключ будет создан автоматически. **Скопируйте его** - он понадобится позже!

   ⚠️ **Важно:** На этом этапе вы можете:
   - Оставить ключ без ограничений (для тестирования)
   - Или сразу настроить ограничения (рекомендуется для production)

5. (Опционально) Настройте ограничения ключа:
   - Нажмите на созданный ключ в списке
   - В разделе **"API restrictions"** выберите **"Restrict key"**
   - Выберите **"Custom Search API"** из списка
   - Нажмите **"Save"** (Сохранить)

6. Скопируйте ваш **API ключ** - он выглядит примерно так:
   ```
   AIzaSyAbCdEfGhIjKlMnOpQrStUvWxYz1234567
   ```

## Шаг 4: Создание поисковой системы (Search Engine)

1. Перейдите на [Google Custom Search](https://programmablesearchengine.google.com/)

2. Нажмите кнопку **"Add"** (Добавить) для создания новой поисковой системы

3. Заполните форму:

   **Sites to search** (Сайты для поиска):
   - Для поиска по всему интернету введите: `*` (звездочка)
   - Или укажите конкретные сайты, например: `example.com`, `news.ru`
   - Можно указать несколько сайтов через пробел

   **Name of the search engine** (Название поисковой системы):
   - Введите любое название, например: "FindOrigin Search"

   **Language** (Язык):
   - Выберите **Russian** (Русский) или **Any language** (Любой язык)

4. Нажмите **"Create"** (Создать)

5. На следующей странице нажмите **"Control Panel"** (Панель управления)

6. На странице настроек найдите раздел **"Basics"** (Основные)

7. Найдите поле **"Search engine ID"** (ID поисковой системы)

8. **Скопируйте Search Engine ID** - он выглядит примерно так:
   ```
   012345678901234567890:abcdefghijk
   ```

## Шаг 5: Настройка поисковой системы (опционально)

1. В панели управления поисковой системы перейдите в **"Setup"** (Настройка)

2. В разделе **"Basics"** (Основные):
   - Убедитесь, что **"Search the entire web"** (Поиск по всему интернету) включен
   - Или настройте конкретные сайты для поиска

3. В разделе **"Advanced"** (Дополнительно):
   - Можно настроить безопасный поиск (SafeSearch)
   - Можно включить поиск по изображениям

4. Нажмите **"Save"** (Сохранить)

## Шаг 6: Добавление ключей в проект

Теперь у вас есть два ключа:

1. **API Key** (из шага 3) - например: `AIzaSyAbCdEfGhIjKlMnOpQrStUvWxYz1234567`
2. **Search Engine ID** (из шага 4) - например: `012345678901234567890:abcdefghijk`

Добавьте их в файл `.env.local`:

```env
GOOGLE_SEARCH_API_KEY=AIzaSyAbCdEfGhIjKlMnOpQrStUvWxYz1234567
GOOGLE_SEARCH_ENGINE_ID=012345678901234567890:abcdefghijk
```

## Шаг 7: Проверка работы API

### Проверка через браузер

Откройте в браузере следующий URL (замените значения на свои):

```
https://www.googleapis.com/customsearch/v1?key=ВАШ_API_КЛЮЧ&cx=ВАШ_SEARCH_ENGINE_ID&q=test
```

Если все настроено правильно, вы увидите JSON с результатами поиска.

### Проверка через PowerShell

```powershell
$apiKey = "ВАШ_API_КЛЮЧ"
$engineId = "ВАШ_SEARCH_ENGINE_ID"
$query = "test"
$url = "https://www.googleapis.com/customsearch/v1?key=$apiKey&cx=$engineId&q=$query"
Invoke-WebRequest -Uri $url | Select-Object -ExpandProperty Content
```

## Лимиты и квоты

⚠️ **Важно знать:**

- **Бесплатный лимит:** 100 запросов в день
- После превышения лимита API вернет ошибку
- Для увеличения лимита нужно настроить биллинг в Google Cloud Console

### Настройка биллинга (для увеличения лимита)

1. В Google Cloud Console перейдите в **"Billing"** (Биллинг)
2. Нажмите **"Link a billing account"** (Привязать счет)
3. Добавьте способ оплаты
4. После этого лимит увеличится до 10,000 запросов в день

## Устранение проблем

### Не получается создать поисковую систему

Если при попытке создать поисковую систему на https://programmablesearchengine.google.com/ возникают проблемы:

1. **Проверьте reCAPTCHA** - убедитесь, что вы прошли проверку "Я не робот"
2. **Попробуйте другой браузер** - иногда помогает Chrome или Firefox
3. **Очистите кеш и cookies** браузера
4. **Проверьте, что вы вошли в правильный Google аккаунт**
5. **Попробуйте режим инкогнито** браузера

**Альтернативное решение:** Используйте SerpAPI вместо Google Custom Search - это намного проще! См. файл `SERPAPI_SETUP.md` для инструкции.

### Ошибка: "403 Forbidden" или "API key not valid"
- **Проверьте, что Custom Search API включен:**
  - Перейдите в Google Cloud Console → APIs & Services → Library
  - Найдите "Custom Search API" и убедитесь, что статус "Enabled"
- **Проверьте ограничения API ключа:**
  - APIs & Services → Credentials → ваш API ключ
  - В разделе "API restrictions" убедитесь, что "Custom Search API" разрешен
  - Или временно выберите "Don't restrict key" для тестирования
- **Проверьте биллинг:**
  - Некоторые регионы требуют настройки биллинга (даже для бесплатного тарифа)
  - Перейдите в Billing и настройте способ оплаты
- Проверьте, что API ключ скопирован полностью, без пробелов
- Убедитесь, что не превышен дневной лимит (100 запросов/день)

### Ошибка: "Invalid value"
- Проверьте правильность Search Engine ID
- Убедитесь, что поисковая система создана и активна

### Ошибка: "Daily Limit Exceeded"
- Вы превысили лимит в 100 запросов в день
- Подождите до следующего дня или настройте биллинг

### Ошибка: "Quota exceeded"
- Настройте биллинг для увеличения квоты
- Или используйте альтернативный API (SerpAPI)

## Альтернатива: SerpAPI

Если у вас возникли проблемы с Google Custom Search API, можно использовать SerpAPI:

1. Зарегистрируйтесь на [SerpAPI](https://serpapi.com/)
2. Получите API ключ из Dashboard
3. Добавьте в `.env.local`:
   ```env
   SERPAPI_KEY=ваш_serpapi_ключ
   ```

SerpAPI предоставляет:
- 100 бесплатных запросов в месяц
- Более простую настройку
- Поддержку различных поисковых систем

## Полезные ссылки

- [Google Cloud Console](https://console.cloud.google.com/)
- [Google Custom Search](https://programmablesearchengine.google.com/)
- [Документация Custom Search API](https://developers.google.com/custom-search/v1/overview)
- [Квоты и лимиты](https://developers.google.com/custom-search/v1/overview#pricing)

