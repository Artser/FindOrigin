# Привязка облака к биллинг-аккаунту в Yandex Cloud

## Проблема

Биллинг-аккаунт активен, но облако не привязано к нему. Это может вызывать ошибку 403 при использовании Yandex GPT API.

## Решение: Привязать облако к биллинг-аккаунту

### Шаг 1: Проверьте роли

Для привязки облака вам нужны **одновременно**:

1. **В биллинг-аккаунте:**
   - Роль `billing.accounts.owner` ИЛИ
   - Роль `billing.accounts.editor`

2. **В облаке:**
   - Роль `owner`

### Шаг 2: Привязка через интерфейс облака

**Способ 1: Через раздел "Биллинг" в облаке**

1. Откройте https://console.cloud.yandex.ru/
2. Выберите ваше облако (например, "Облако 1")
3. Перейдите в раздел **"Биллинг"** (в меню слева)
4. Нажмите **"Привязать платёжный аккаунт"**
5. Выберите биллинг-аккаунт "account-766"
6. Подтвердите привязку

**Способ 2: Через раздел "Биллинг" в биллинг-аккаунте**

1. Откройте https://console.cloud.yandex.ru/billing
2. Выберите биллинг-аккаунт "account-766"
3. В разделе **"Привязанные облака и сервисы"** нажмите **"Показать все"**
4. Нажмите кнопку **"+"** (добавить)
5. Выберите тип "Облако"
6. Выберите ваше облако из списка
7. Нажмите **"Привязать"**

### Шаг 3: Если облако не отображается в списке

**Проблема:** "Нет доступных облаков для привязки"

**Причины:**
1. У вас нет нужных ролей
2. Облако уже привязано к другому биллинг-аккаунту
3. Облако не создано

**Решение:**

1. **Проверьте роли:**
   - Откройте https://console.cloud.yandex.ru/
   - Выберите ваше облако
   - Перейдите в **"Управление доступом"**
   - Убедитесь, что у вас есть роль `owner`

2. **Проверьте биллинг-аккаунт:**
   - Откройте https://console.cloud.yandex.ru/billing
   - Выберите биллинг-аккаунт "account-766"
   - Перейдите в **"Управление доступом"**
   - Убедитесь, что у вас есть роль `billing.accounts.owner` или `billing.accounts.editor`

3. **Если облако привязано к другому аккаунту:**
   - Сначала отвяжите его от старого биллинг-аккаунта
   - Затем привяжите к новому

### Шаг 4: Проверка привязки

После привязки:

1. Откройте https://console.cloud.yandex.ru/billing
2. Выберите биллинг-аккаунт "account-766"
3. В разделе **"Привязанные облака и сервисы"** должно отображаться ваше облако

## Альтернативное решение: Использовать другой поисковый API

Если привязка облака вызывает сложности, можно использовать другой поисковый API:

### Вариант 1: Google Custom Search API

Добавьте в `.env.local`:
```env
GOOGLE_SEARCH_API_KEY=ваш_ключ
GOOGLE_SEARCH_ENGINE_ID=ваш_id
```

### Вариант 2: Bing Search API

Добавьте в `.env.local`:
```env
BING_SEARCH_API_KEY=ваш_ключ
```

### Вариант 3: SerpAPI

Добавьте в `.env.local`:
```env
SERPAPI_KEY=ваш_ключ
```

После настройки другого API, Yandex GPT будет использоваться только если другие API недоступны.

## После привязки облака

1. **Перезапустите сервер:**
   ```powershell
   # Остановите сервер (Ctrl+C)
   # Затем запустите снова:
   npm run dev
   ```

2. **Проверьте работу:**
   - Откройте `http://localhost:3000`
   - Выполните поиск
   - Ошибка 403 должна исчезнуть

## Дополнительная информация

- [Документация Yandex Cloud: Роли в сервисе Billing](https://cloud.yandex.ru/docs/billing/security/)
- [Документация Yandex Cloud: Привязка облака к биллинг-аккаунту](https://cloud.yandex.ru/docs/billing/operations/link-cloud/)

## Если проблема сохраняется

1. Убедитесь, что биллинг-аккаунт **активен** (зеленый значок "Active")
2. Убедитесь, что облако **привязано** к биллинг-аккаунту
3. Проверьте, что API ключ имеет правильный формат (начинается с `AQVN...` или `AQAAA...`)
4. Проверьте, что `YANDEX_FOLDER_ID` указывает на правильный каталог в привязанном облаке
5. Убедитесь, что сервисный аккаунт имеет роль `ai.languageModels.user` или выше



