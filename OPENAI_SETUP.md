# Настройка OpenAI API для AI-анализа

## Обзор

Проект использует OpenAI API (модель `gpt-4o-mini`) для анализа найденных источников и сравнения их смысла с исходным текстом.

## Шаг 1: Получение API ключа OpenAI

### Вариант A: Прямой доступ к OpenAI (если доступен)

1. Перейдите на [OpenAI Platform](https://platform.openai.com/)
2. Войдите в аккаунт или создайте новый
3. Перейдите в раздел **API Keys** (https://platform.openai.com/api-keys)
4. Нажмите **"Create new secret key"**
5. Скопируйте ключ (начинается с `sk-...`)
6. **ВАЖНО:** Сохраните ключ сразу, он больше не будет показан!

### Вариант B: Использование через OpenRouter (альтернативный способ)

Если прямой доступ к OpenAI недоступен, можно использовать OpenRouter:

1. Зарегистрируйтесь на [OpenRouter](https://openrouter.ai/)
2. Получите API ключ
3. Установите переменные окружения:
   ```env
   OPENAI_API_KEY=ваш_ключ_от_openrouter
   OPENAI_BASE_URL=https://openrouter.ai/api/v1
   ```

## Шаг 2: Настройка переменных окружения

Откройте файл `.env.local` и добавьте:

```env
# OpenAI API Configuration
OPENAI_API_KEY=sk-ваш_ключ_здесь
OPENAI_BASE_URL=https://api.openai.com/v1
```

**Для OpenRouter:**
```env
OPENAI_API_KEY=ваш_ключ_от_openrouter
OPENAI_BASE_URL=https://openrouter.ai/api/v1
```

## Шаг 3: Перезапуск сервера

После добавления переменных окружения перезапустите сервер разработки:

```powershell
# Остановите текущий сервер (Ctrl+C)
# Затем запустите снова:
npm run dev
```

## Как это работает

1. **Поиск источников** - система ищет источники через Yandex GPT API, Google Custom Search API, Bing Search API или SerpAPI
2. **Получение контента** - система получает текст из найденных источников
3. **AI-анализ** - OpenAI GPT-4o-mini сравнивает исходный текст с текстами из источников:
   - Определяет степень совпадения смысла (0-100%)
   - Находит совпадения и различия
   - Формирует общее резюме анализа

## Результат AI-анализа

Для каждого источника AI предоставляет:
- **Уверенность** (0-100%): степень совпадения смысла с исходным текстом
- **Объяснение**: краткое описание совпадений или различий
- **Общее резюме**: сводка по всем источникам

## Уровни уверенности

- **70-100%** (✅): Высокая уверенность - источник подтверждает информацию
- **40-69%** (⚠️): Средняя уверенность - частичное совпадение или неполная информация
- **0-39%** (❌): Низкая уверенность - источник не подтверждает или опровергает информацию

## Устранение неполадок

### Ошибка: "OPENAI_API_KEY не установлен"

**Решение:** Убедитесь, что переменная `OPENAI_API_KEY` добавлена в `.env.local` и сервер перезапущен.

### Ошибка: "OpenAI API error (401): Unauthorized"

**Решение:** Проверьте правильность API ключа. Убедитесь, что ключ активен и имеет доступ к API.

### Ошибка: "OpenAI API error (429): Rate limit exceeded"

**Решение:** Превышен лимит запросов. Подождите или обновите план подписки на OpenAI.

### Ошибка: "OpenAI API error (403): Forbidden"

**Решение:** API ключ не имеет доступа к модели `gpt-4o-mini`. Проверьте настройки доступа в OpenAI Dashboard.

### AI-анализ не выполняется

**Решение:** 
1. Проверьте, что `OPENAI_API_KEY` установлен в `.env.local`
2. Убедитесь, что сервер перезапущен после добавления переменной
3. Проверьте логи сервера на наличие ошибок

## Альтернативные модели

По умолчанию используется `gpt-4o-mini`. Чтобы использовать другую модель, измените параметр в `lib/openai.ts`:

```typescript
await callOpenAI(messages, 'gpt-3.5-turbo'); // или другая модель
```

## Стоимость

- **gpt-4o-mini**: ~$0.15 за 1M входных токенов, ~$0.60 за 1M выходных токенов
- **gpt-3.5-turbo**: ~$0.50 за 1M входных токенов, ~$1.50 за 1M выходных токенов

Один запрос на анализ обычно использует ~500-2000 токенов.


