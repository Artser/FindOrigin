# Инструкция по созданию API ключа в Yandex Cloud

## Важно

⚠️ **Создавайте именно API ключ, а НЕ IAM токен и НЕ SSH ключ!**

API ключ начинается с `AQVN...` или `AQAAA...` и используется для доступа к API сервисов Yandex Cloud.

## Шаг 1: Создание сервисного аккаунта (если еще нет)

Перед созданием API ключа нужен сервисный аккаунт:

1. Откройте [Yandex Cloud Console](https://console.cloud.yandex.ru/)
2. Войдите с вашим Яндекс аккаунтом
3. Выберите нужное облако
4. Перейдите в раздел **"Сервисные аккаунты"** (Service accounts)
   - Или откройте напрямую: https://console.cloud.yandex.ru/cloud/cloud-id/service-accounts
5. Нажмите **"Создать сервисный аккаунт"** (Create service account)
6. Заполните форму:
   - **Имя:** любое имя (например: "FindOrigin Service Account")
   - **Описание:** опционально
7. Нажмите **"Создать"**

## Шаг 2: Переход в раздел "Сервисные аккаунты"

1. В Yandex Cloud Console перейдите в раздел **"Сервисные аккаунты"** (Service accounts)
   - Меню слева → **"Сервисные аккаунты"**
   - Или прямая ссылка: https://console.cloud.yandex.ru/cloud/cloud-id/service-accounts

2. Найдите созданный сервисный аккаунт в списке

3. **Нажмите на название сервисного аккаунта** (не на галочку, а именно на название)

## Шаг 3: Переход на вкладку "Ключи"

1. После открытия страницы сервисного аккаунта вы увидите несколько вкладок:
   - **Обзор** (Overview)
   - **Права доступа** (Access rights)
   - **Ключи** (Keys) ← **Выберите эту вкладку**
   - **Роли** (Roles)

2. Нажмите на вкладку **"Ключи"** (Keys)

## Шаг 4: Создание API ключа

1. На вкладке "Ключи" нажмите кнопку **"Создать новый ключ"** (Create new key)

2. В выпадающем меню выберите **"API ключ"** (API key)
   - ⚠️ **Важно:** НЕ выбирайте "IAM токен" или "SSH ключ"!

3. Заполните описание (опционально):
   - Например: "FindOrigin API Key"
   - Это поможет идентифицировать ключ позже

4. Нажмите **"Создать"** (Create)

## Шаг 5: Копирование ключа

1. После создания ключа откроется окно с вашим API ключом

2. **Ключ будет показан только один раз!** ⚠️

3. API ключ выглядит примерно так:
   ```
   AQVNxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```
   или
   ```
   AQAAAxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```

4. **Скопируйте весь ключ полностью:**
   - Выделите весь текст ключа
   - Нажмите Ctrl+C (или правой кнопкой → Копировать)
   - Или нажмите кнопку "Скопировать" рядом с ключом (если есть)

5. ⚠️ **ВАЖНО:** Копируйте только сам ключ (строку, начинающуюся с `AQVN...` или `AQAAA...`)
   - НЕ копируйте SSH приватный ключ (если он показан)
   - НЕ копируйте IAM токен
   - НЕ копируйте другие данные

6. **Сохраните ключ сразу:**
   - Вставьте в файл `.env` или `.env.local`
   - Или сохраните в безопасном месте
   - ⚠️ **После закрытия окна ключ больше не будет показан!**

7. Нажмите **"Закрыть"** (Close) после сохранения

## Шаг 6: Добавление ключа в проект

Откройте файл `.env` или `.env.local` и добавьте:

```env
YANDEX_CLOUD_API_KEY=AQVNxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**Пример:**
```env
YANDEX_CLOUD_API_KEY=AQVN1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t1u2v3w4x5y6z7
```

⚠️ **Важно:**
- Не добавляйте пробелы вокруг знака `=`
- Не добавляйте кавычки вокруг ключа
- Копируйте ключ полностью, без переносов строк

## Проверка правильности ключа

API ключ Yandex Cloud должен:
- ✅ Начинаться с `AQVN...` или `AQAAA...`
- ✅ Быть длиной примерно 50-60 символов
- ✅ Содержать только буквы и цифры (без пробелов и специальных символов)

**Неправильные форматы:**
- ❌ SSH ключ (начинается с `-----BEGIN`)
- ❌ IAM токен (другой формат)
- ❌ OAuth токен (начинается с `y0_AgA...`)

## Устранение проблем

### Не вижу раздел "Сервисные аккаунты"

**Решение:**
- Убедитесь, что вы выбрали правильное облако
- Проверьте права доступа (нужны права администратора)
- Попробуйте прямую ссылку: https://console.cloud.yandex.ru/cloud/cloud-id/service-accounts

### Не вижу вкладку "Ключи"

**Решение:**
- Убедитесь, что вы открыли страницу сервисного аккаунта (нажали на его название)
- Проверьте, что вы находитесь в правильном разделе
- Обновите страницу

### Создал не тот тип ключа

**Решение:**
1. Удалите неправильный ключ:
   - Вкладка "Ключи" → найдите ключ → нажмите "Удалить"
2. Создайте новый ключ:
   - "Создать новый ключ" → выберите **"API ключ"** (не IAM токен!)

### Потерял ключ

**Решение:**
- ⚠️ API ключ показывается только один раз при создании
- Если вы потеряли ключ, нужно создать новый:
  1. Удалите старый ключ (если нужно)
  2. Создайте новый API ключ
  3. Скопируйте и сохраните его сразу

### Ключ не работает

**Проверьте:**
1. Правильность формата ключа (начинается с `AQVN...` или `AQAAA...`)
2. Что ключ скопирован полностью, без пробелов
3. Что ключ добавлен в `.env.local` (не в `.env`, если используете Next.js)
4. Что сервер перезапущен после добавления ключа
5. Что биллинг-аккаунт активен (см. `YANDEX_CLOUD_BILLING_SETUP.md`)

## Безопасность API ключа

⚠️ **Важные правила безопасности:**

1. **Не публикуйте ключ в открытом доступе:**
   - Не коммитьте в Git
   - Не отправляйте в чаты или email
   - Не публикуйте в документации

2. **Используйте `.env.local` или `.env`:**
   - Эти файлы должны быть в `.gitignore`
   - Не добавляйте их в репозиторий

3. **Ограничьте права доступа:**
   - Дайте сервисному аккаунту только необходимые роли
   - Не давайте права администратора без необходимости

4. **Регулярно ротируйте ключи:**
   - Периодически создавайте новые ключи
   - Удаляйте старые неиспользуемые ключи

5. **Мониторьте использование:**
   - Проверяйте логи использования API
   - Настройте уведомления о подозрительной активности

## Полезные ссылки

- **Yandex Cloud Console:** https://console.cloud.yandex.ru/
- **Сервисные аккаунты:** https://console.cloud.yandex.ru/cloud/cloud-id/service-accounts
- **Документация по API ключам:** https://cloud.yandex.ru/docs/iam/operations/api-key/create
- **Документация по сервисным аккаунтам:** https://cloud.yandex.ru/docs/iam/concepts/users/service-accounts

## Быстрая навигация

```
Yandex Cloud Console
  └─ Сервисные аккаунты (Service accounts)
      └─ [Выбрать сервисный аккаунт]
          └─ Вкладка "Ключи" (Keys)
              └─ Создать новый ключ
                  └─ API ключ (API key)
                      └─ Скопировать ключ (AQVN... или AQAAA...)
                          └─ Сохранить в .env.local
                              └─ Готово! ✅
```

## Чек-лист

После создания API ключа проверьте:

- ✅ Сервисный аккаунт создан
- ✅ API ключ создан (начинается с `AQVN...` или `AQAAA...`)
- ✅ Ключ скопирован и сохранен
- ✅ Ключ добавлен в `.env.local` как `YANDEX_CLOUD_API_KEY=...`
- ✅ Сервер перезапущен
- ✅ Биллинг-аккаунт активен
- ✅ Ключ не опубликован в открытом доступе

## Пример использования в коде

После добавления ключа в `.env.local`:

```typescript
// В вашем коде
const apiKey = process.env.YANDEX_CLOUD_API_KEY;

if (!apiKey) {
  throw new Error('YANDEX_CLOUD_API_KEY не установлен');
}

// Использование ключа для запросов к Yandex Cloud API
```



