# Устранение проблем с веб-интерфейсом поиска

## Ошибка: "Произошла ошибка при поиске источников"

Эта ошибка может возникать по нескольким причинам. Ниже описаны наиболее частые случаи и способы их решения.

## Проблема 1: API ключи не настроены

### Симптомы:
- Ошибка: "Не настроен ни один поисковый API"
- Ошибка: "API key не установлен"

### Решение:

1. **Проверьте файл `.env.local`** (или `.env`) в корне проекта

2. **Добавьте хотя бы один из следующих API:**

#### Вариант A: Google Custom Search API
```env
GOOGLE_SEARCH_API_KEY=ваш_google_api_ключ
GOOGLE_SEARCH_ENGINE_ID=ваш_search_engine_id
```

#### Вариант B: Bing Search API
```env
BING_SEARCH_API_KEY=ваш_bing_api_ключ
```

#### Вариант C: SerpAPI
```env
SERPAPI_KEY=ваш_serpapi_ключ
```

3. **Перезапустите сервер разработки:**
   ```powershell
   # Остановите текущий (Ctrl+C)
   npm run dev
   ```

## Проблема 2: Неправильный формат переменных окружения

### Симптомы:
- API ключи добавлены, но не работают
- Ошибка: "API key не установлен"

### Решение:

1. **Проверьте формат в `.env.local`:**
   - ✅ Правильно: `GOOGLE_SEARCH_API_KEY=ваш_ключ`
   - ❌ Неправильно: `GOOGLE_SEARCH_API_KEY = ваш_ключ` (пробелы вокруг =)
   - ❌ Неправильно: `GOOGLE_SEARCH_API_KEY="ваш_ключ"` (кавычки)

2. **Убедитесь, что нет лишних пробелов:**
   - В начале строки
   - В конце строки
   - Вокруг знака `=`

3. **Проверьте, что файл называется `.env.local`** (для Next.js)

## Проблема 3: Ошибка доступа к API (403 Forbidden)

### Симптомы:
- Ошибка: "Ошибка доступа к API (403)"
- API ключ правильный, но запрос отклоняется

### Решение для Google Custom Search API:

1. **Проверьте, что Custom Search API включен:**
   - https://console.cloud.google.com/apis/library/customsearch.googleapis.com
   - Статус должен быть "Enabled"

2. **Проверьте ограничения API ключа:**
   - https://console.cloud.google.com/apis/credentials
   - Откройте ваш API ключ
   - В "API restrictions" должен быть выбран "Custom Search API"

3. **Проверьте биллинг:**
   - https://console.cloud.yandex.ru/billing
   - Биллинг-аккаунт должен быть активен

### Решение для Bing Search API:

1. **Проверьте правильность API ключа**
2. **Проверьте лимиты в Azure Portal**

## Проблема 4: Превышен лимит запросов

### Симптомы:
- Ошибка: "Превышен лимит запросов"
- Ошибка с кодом 429

### Решение:

1. **Google Custom Search API:**
   - Лимит: 100 запросов в день (бесплатно)
   - Подождите до следующего дня
   - Или настройте биллинг для увеличения лимита

2. **Bing Search API:**
   - Лимит: 3,000 запросов в месяц (бесплатно)
   - Подождите до следующего месяца

3. **SerpAPI:**
   - Лимит: 100 запросов в месяц (бесплатно)
   - Подождите до следующего месяца

## Проблема 5: Сервер не запущен

### Симптомы:
- Ошибка при выполнении запроса
- Сеть недоступна

### Решение:

1. **Убедитесь, что сервер запущен:**
   ```powershell
   npm run dev
   ```

2. **Проверьте, что сервер работает на `http://localhost:3000`**

3. **Проверьте консоль браузера (F12) на наличие ошибок**

## Проблема 6: Ошибка авторизации (401)

### Симптомы:
- Ошибка: "Ошибка авторизации (401)"
- API ключ неверный

### Решение:

1. **Проверьте правильность API ключа:**
   - Скопирован полностью, без пробелов
   - Нет лишних символов
   - Ключ актуален (не истек)

2. **Проверьте переменные окружения:**
   - Откройте `.env.local`
   - Убедитесь, что ключ правильный

3. **Перезапустите сервер** после изменения `.env.local`

## Диагностика

### Шаг 1: Проверьте логи сервера

В терминале, где запущен `npm run dev`, проверьте ошибки:
- Они покажут точную причину проблемы

### Шаг 2: Проверьте консоль браузера

1. Откройте DevTools (F12)
2. Перейдите на вкладку "Console"
3. Выполните поиск
4. Проверьте ошибки

### Шаг 3: Проверьте Network запросы

1. Откройте DevTools (F12)
2. Перейдите на вкладку "Network"
3. Выполните поиск
4. Найдите запрос к `/api/search`
5. Проверьте ответ сервера

### Шаг 4: Проверьте переменные окружения

Создайте тестовый файл для проверки:

```typescript
// test-env.ts (временно)
console.log('GOOGLE_SEARCH_API_KEY:', process.env.GOOGLE_SEARCH_API_KEY ? 'Установлен' : 'Не установлен');
console.log('BING_SEARCH_API_KEY:', process.env.BING_SEARCH_API_KEY ? 'Установлен' : 'Не установлен');
console.log('SERPAPI_KEY:', process.env.SERPAPI_KEY ? 'Установлен' : 'Не установлен');
```

## Быстрая проверка

Выполните эту команду для проверки API:

```powershell
# Для Google Custom Search API
$apiKey = "ваш_ключ"
$engineId = "c3818dfb6fe534e25"
$url = "https://www.googleapis.com/customsearch/v1?key=$apiKey&cx=$engineId&q=test"
Invoke-WebRequest -Uri $url | Select-Object -ExpandProperty Content

# Для Bing Search API
$apiKey = "ваш_ключ"
$url = "https://api.bing.microsoft.com/v7.0/search?q=test&mkt=ru-RU"
$headers = @{"Ocp-Apim-Subscription-Key" = $apiKey}
Invoke-WebRequest -Uri $url -Headers $headers | Select-Object -ExpandProperty Content
```

Если команда работает, значит API настроен правильно, и проблема в коде приложения.

## Полезные ссылки

- **Настройка Google Custom Search API:** `GOOGLE_API_SETUP.md`
- **Настройка Bing Search API:** `RUSSIA_ALTERNATIVES.md`
- **Настройка SerpAPI:** `SERPAPI_SETUP.md`
- **Настройка Yandex Cloud:** `YANDEX_ENV_SETUP.md`

## Чек-лист

Перед использованием веб-интерфейса убедитесь:

- ✅ Хотя бы один поисковый API настроен в `.env.local`
- ✅ Нет пробелов вокруг знака `=` в `.env.local`
- ✅ Сервер разработки запущен (`npm run dev`)
- ✅ Файл `.env.local` находится в корне проекта
- ✅ Сервер перезапущен после изменения `.env.local`
- ✅ API ключи правильные и актуальные
- ✅ Биллинг настроен (если требуется)





