# Исправление проблемы с OPENAI_API_KEY

## Проблема

Бот не работает, потому что `OPENAI_API_KEY` не установлен или неправильно настроен.

## Решение

### Шаг 1: Добавьте OPENAI_API_KEY в .env.local

Откройте файл `.env.local` и добавьте (или исправьте) строку:

```env
OPENAI_API_KEY=sk-ваш_ключ_здесь
```

**ВАЖНО:**
- Ключ должен начинаться с `sk-`
- Не должно быть пробелов вокруг знака `=`
- Строка не должна быть закомментирована (не должно быть `#` в начале)

### Шаг 2: Получите API ключ OpenAI

Если у вас еще нет ключа:

1. Перейдите на https://platform.openai.com/
2. Войдите в аккаунт или создайте новый
3. Перейдите в раздел **API Keys**: https://platform.openai.com/api-keys
4. Нажмите **"Create new secret key"**
5. Скопируйте ключ (начинается с `sk-...`)
6. **ВАЖНО:** Сохраните ключ сразу, он больше не будет показан!

### Шаг 3: Перезапустите сервер

После добавления ключа **обязательно перезапустите сервер**:

```powershell
# Остановите сервер (Ctrl+C в терминале с npm run dev)
# Затем запустите снова:
npm run dev
```

### Шаг 4: Проверьте работу

1. Отправьте боту команду `/start`
2. Отправьте боту любой текст
3. Бот должен начать обработку и выполнить AI-анализ

## Альтернатива: Использование OpenRouter

Если прямой доступ к OpenAI недоступен, можно использовать OpenRouter:

1. Зарегистрируйтесь на https://openrouter.ai/
2. Получите API ключ
3. Добавьте в `.env.local`:
   ```env
   OPENAI_API_KEY=ваш_ключ_от_openrouter
   OPENAI_BASE_URL=https://openrouter.ai/api/v1
   ```

## Проверка правильности ключа

После добавления ключа проверьте:

```powershell
# Проверьте, что ключ добавлен
Get-Content .env.local | Select-String "OPENAI_API_KEY"
```

Должна быть строка вида:
```
OPENAI_API_KEY=sk-proj-...
```

## Если проблема сохраняется

1. **Проверьте логи сервера** - там должны быть детальные ошибки
2. **Убедитесь, что ключ правильный** - проверьте на https://platform.openai.com/api-keys
3. **Проверьте баланс** - убедитесь, что на аккаунте OpenAI есть средства
4. **Проверьте права доступа** - ключ должен иметь доступ к API

## Типичные ошибки

### "OPENAI_API_KEY не установлен"
- Ключ не добавлен в `.env.local`
- Строка закомментирована (есть `#` в начале)
- Сервер не перезапущен после добавления ключа

### "OpenAI API error (401): Unauthorized"
- Неправильный ключ
- Ключ был отозван
- Проверьте ключ на https://platform.openai.com/api-keys

### "OpenAI API error (429): Rate limit exceeded"
- Превышен лимит запросов
- Подождите или обновите план подписки

### "OpenAI API error (403): Forbidden"
- Ключ не имеет доступа к модели `gpt-4o-mini`
- Проверьте настройки доступа в OpenAI Dashboard


