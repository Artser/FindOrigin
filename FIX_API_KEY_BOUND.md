# Решение проблемы: API ключ не привязан к API

## Проблема

В Google Cloud Console вы видите, что ваш API ключ имеет:
- ⚠️ Предупреждение о неограниченном ключе
- **"Bound" = "-"** (ключ не привязан к API)

Это означает, что ключ не настроен для работы с Custom Search API.

## Решение

### Вариант 1: Настроить ограничения ключа (Рекомендуется)

1. **Нажмите на название вашего API ключа** ("GOOGLE_SEARCH_API_KEY")

2. В открывшейся форме найдите раздел **"API restrictions"**

3. Выберите **"Restrict key"** (Ограничить ключ)

4. В выпадающем списке найдите и выберите:
   - ✅ **"Custom Search API"**
   - Можно выбрать только этот API или несколько нужных

5. Нажмите **"Save"** (Сохранить)

6. Подождите несколько секунд, пока изменения применятся

### Вариант 2: Временно оставить ключ неограниченным (для тестирования)

Если вы хотите быстро протестировать:

1. Закройте предупреждение (нажмите X)
2. Убедитесь, что **Custom Search API включен** в проекте:
   - Перейдите в **APIs & Services** → **Library**
   - Найдите "Custom Search API"
   - Убедитесь, что статус "Enabled"

3. Попробуйте использовать ключ

⚠️ **Важно:** Неограниченный ключ менее безопасен, но для тестирования это нормально.

## Проверка после настройки

После настройки ограничений:

1. Вернитесь в список API ключей
2. Проверьте, что в колонке **"Bound"** теперь указано количество API (например, "1")
3. Попробуйте снова выполнить тестовый запрос:

```powershell
$apiKey = "ваш_api_ключ"
$engineId = "c3818dfb6fe534e25"
$url = "https://www.googleapis.com/customsearch/v1?key=$apiKey&cx=$engineId&q=test"

try {
    $response = Invoke-WebRequest -Uri $url -ErrorAction Stop
    Write-Host "✅ Успех!" -ForegroundColor Green
    $response.Content | ConvertFrom-Json | ConvertTo-Json -Depth 3
} catch {
    Write-Host "❌ Ошибка: $($_.Exception.Message)" -ForegroundColor Red
}
```

## Дополнительные проверки

Если ошибка 403 все еще возникает:

### 1. Проверьте, что Custom Search API включен

```
https://console.cloud.google.com/apis/library/customsearch.googleapis.com
```

Статус должен быть **"Enabled"**

### 2. Проверьте биллинг

Некоторые регионы требуют настройки биллинга:
- Перейдите в **Billing**
- Настройте способ оплаты (деньги не списываются на бесплатном тарифе)

### 3. Проверьте квоты

- Перейдите в **APIs & Services** → **Dashboard**
- Найдите "Custom Search API"
- Проверьте, что не превышен дневной лимит (100 запросов/день)

## Безопасность API ключа

После того как все заработает, рекомендуется:

1. **Ограничить ключ по API** (как описано выше)
2. **Ограничить по HTTP referrers** (если используете в веб-приложении)
3. **Ограничить по IP-адресам** (если используете на сервере)

Но для начала достаточно ограничить по API.

## Альтернатива

Если проблемы продолжаются, используйте **Bing Search API**:
- Проще настройка
- Работает в России
- 3,000 запросов/месяц бесплатно

См. файл `RUSSIA_ALTERNATIVES.md`





